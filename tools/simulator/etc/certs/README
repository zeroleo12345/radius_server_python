rm -rf ./newcerts/
rm -rf ./*.old
rm -rf ./*.attr

# 修改openssl配置
vim /usr/local/ssl/openssl.cnf
    [ CA_default ]
    #dir     = ./demoCA      # TSA root directory
    dir     = ./     # TSA root directory

# 生成目录
mkdir certs newcerts && cd certs
touch index.txt; echo 01 > serial;

# 生成CA根证书私钥
openssl genrsa -out ./ca.key.pem 2048

# 通过CA根证书私钥, 生成CA根证书
openssl req -new -x509 -days 365 -key ./ca.key.pem -out ./ca.cer.pem
    You are about to be asked to enter information that will be incorporated
    into your certificate request.
    What you are about to enter is what is called a Distinguished Name or a DN.
    There are quite a few fields but you can leave some blank
    For some fields there will be a default value,
    If you enter '.', the field will be left blank.
    -----
    Country Name (2 letter code) [AU]:CN
    State or Province Name (full name) [Some-State]:GD     
    Locality Name (eg, city) []:GZ
    Organization Name (eg, company) [Internet Widgits Pty Ltd]:E
    Organizational Unit Name (eg, section) []:EIS
    Common Name (e.g. server FQDN or YOUR name) []:MAN
    Email Address []:email
    
# 生成服务端私钥
openssl genrsa -out ./server.key.pem
    Generating RSA private key, 2048 bit long modulus
    ...............................................+++
    ..............................................+++
    e is 65537 (0x10001)
    Enter pass phrase for private/serverkey.pem:1234
    Verifying - Enter pass phrase for private/serverkey.pem:1234
    
# 通过服务端私钥, 生成服务端证书签名请求
openssl req -new -days 3650 -key ./server.key.pem -out ./server.csr.pem
    You are about to be asked to enter information that will be incorporated
    into your certificate request.
    What you are about to enter is what is called a Distinguished Name or a DN.
    There are quite a few fields but you can leave some blank
    For some fields there will be a default value,
    If you enter '.', the field will be left blank.
    -----
    Country Name (2 letter code) [AU]:CN
    State or Province Name (full name) [Some-State]:GD
    Locality Name (eg, city) []:GZ
    Organization Name (eg, company) [Internet Widgits Pty Ltd]:E
    Organizational Unit Name (eg, section) []:EIS
    Common Name (e.g. server FQDN or YOUR name) []:MAN
    Email Address []:email

    Please enter the following 'extra' attributes
    to be sent with your certificate request
    A challenge password []:1234
    An optional company name []:E
    
# 通过CA根证书私钥、CA根证书、服务端证书签名请求, 生成服务端证书
openssl ca -keyfile ./ca.key.pem -cert ca.cer.pem -in ./server.csr.pem -out ./server.cer.pem
    Using configuration from /usr/local/ssl/openssl.cnf
    Check that the request matches the signature
    Signature ok
    Certificate Details:
            Serial Number: 1 (0x1)
            Validity
                Not Before: Jan 23 12:12:07 2016 GMT
                Not After : Jan 22 12:12:07 2017 GMT
            Subject:
                countryName               = CN
                stateOrProvinceName       = GD
                organizationName          = E
                organizationalUnitName    = EIS
                commonName                = MAN
                emailAddress              = email
            X509v3 extensions:
                X509v3 Basic Constraints:
                    CA:FALSE
                Netscape Comment:
                    OpenSSL Generated Certificate
                X509v3 Subject Key Identifier:
                    6F:E5:BE:98:0D:80:CB:69:88:DF:A4:24:22:98:FB:68:30:A5:70:FF
                X509v3 Authority Key Identifier:
                    keyid:BE:E5:7D:C1:8A:23:94:0B:43:6E:B5:33:FC:ED:D7:D8:5C:76:38:EA

    Certificate is to be certified until Jan 22 12:12:07 2017 GMT (365 days)
    Sign the certificate? [y/n]:y
    1 out of 1 certificate requests certified, commit? [y/n]y
    Write out database with 1 new entries
    Data Base Updated

# 生成客户端私钥
openssl genrsa -des3 -out ./client.key.pem
    Generating RSA private key, 512 bit long modulus
    ....++++++++++++
    .++++++++++++
    e is 65537 (0x10001)
    Enter pass phrase for private/clientkey.pem:1234
    Verifying - Enter pass phrase for private/clientkey.pem:1234
    
# 通过客户端私钥, 生成客户端证书签名请求
openssl req -new -days 365 -key ./client.key.pem -out ./client.csr.pem
    Enter pass phrase for private/clientkey.pem:1234
    You are about to be asked to enter information that will be incorporated
    into your certificate request.
    What you are about to enter is what is called a Distinguished Name or a DN.
    There are quite a few fields but you can leave some blank
    For some fields there will be a default value,
    If you enter '.', the field will be left blank.
    -----
    Country Name (2 letter code) [AU]:CN
    State or Province Name (full name) [Some-State]:GD
    Locality Name (eg, city) []:GZ
    Organization Name (eg, company) [Internet Widgits Pty Ltd]:E
    Organizational Unit Name (eg, section) []:EIS
    Common Name (e.g. server FQDN or YOUR name) []:MAN
    Email Address []:email
    Please enter the following 'extra' attributes
    to be sent with your certificate request
    A challenge password []:1234
    An optional company name []:E
    
# 通过CA根证书私钥、CA根证书、客户端证书签名请求, 生成客户端证书
openssl ca -keyfile ./ca.key.pem -cert ./ca.cer.pem -in ./client.csr.pem -out ./client.cer.pem
    Using configuration from /usr/local/ssl/openssl.cnf
    Check that the request matches the signature
    Signature ok
    Certificate Details:
            Serial Number: 2 (0x2)
            Validity
                Not Before: Oct 25 05:50:23 2020 GMT
                Not After : Oct 25 05:50:23 2021 GMT
            Subject:
                countryName               = CN
                stateOrProvinceName       = GD
                organizationName          = E
                organizationalUnitName    = EIS
                commonName                = MAN
                emailAddress              = email
            X509v3 extensions:
                X509v3 Basic Constraints: 
                    CA:FALSE
                Netscape Comment: 
                    OpenSSL Generated Certificate
                X509v3 Subject Key Identifier: 
                    03:87:E8:0B:87:9B:A1:89:A9:4D:73:90:6A:06:B6:6B:AD:E6:33:E1
                X509v3 Authority Key Identifier: 
                    keyid:9B:5D:7E:3F:59:6C:3E:6E:5C:25:4A:2C:6E:EB:70:DB:C9:3B:F9:C1

    Certificate is to be certified until Oct 25 05:50:23 2021 GMT (365 days)
    Sign the certificate? [y/n]:y
    failed to update database
    TXT_DB error number 2

# 生成dh文件
openssl dhparam -out ./dh 1024
